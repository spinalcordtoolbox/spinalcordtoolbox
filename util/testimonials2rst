#!/bin/sh

# convert testimonials collected from https://docs.google.com/forms/d/1tJuIVtQ400G6dooZ0P0yukVNfp57b_uF9K5MXnfHLxU/
# into .rst for publication.
#
# usage:
# 1. Log in with a lab member google account
# 2. Go to https://docs.google.com/forms/d/1tJuIVtQ400G6dooZ0P0yukVNfp57b_uF9K5MXnfHLxU/edit#responses
# 3. Click the "Sheets" icon.
# 4. Export to .tsv with File->Download->TSV
# 5. `utils/testimonials2rst 'Testimonials\ for\ SCT\ \(Responses\)\ -\ Form\ Responses\ 1.tsv'`
# 6. Curate the .tsv to order the rows to highlight preferred testimonials.
# 7. Go to 5 until satisfied.
# 8. Publish: `git add documentation/ && git commit -m "Update testimonials" && git push`

testimonials2rst() {
awk '
BEGIN {
  FS="\t" # make awk process .tsv files

  # lookup table of flag emojis
  FLAGS["ascension island"]="ğŸ‡¦ğŸ‡¨"
  FLAGS["andorra"]="ğŸ‡¦ğŸ‡©"
  FLAGS["united arab emirates"]="ğŸ‡¦ğŸ‡ª"
  FLAGS["afghanistan"]="ğŸ‡¦ğŸ‡«"
  FLAGS["antigua and barbuda"]="ğŸ‡¦ğŸ‡¬"
  FLAGS["anguilla"]="ğŸ‡¦ğŸ‡®"
  FLAGS["albania"]="ğŸ‡¦ğŸ‡±"
  FLAGS["armenia"]="ğŸ‡¦ğŸ‡²"
  FLAGS["angola"]="ğŸ‡¦ğŸ‡´"
  FLAGS["antarctica"]="ğŸ‡¦ğŸ‡¶"
  FLAGS["argentina"]="ğŸ‡¦ğŸ‡·"
  FLAGS["american samoa"]="ğŸ‡¦ğŸ‡¸"
  FLAGS["austria"]="ğŸ‡¦ğŸ‡¹"
  FLAGS["australia"]="ğŸ‡¦ğŸ‡º"
  FLAGS["aruba"]="ğŸ‡¦ğŸ‡¼"
  FLAGS["Ã¥land islands"]="ğŸ‡¦ğŸ‡½"
  FLAGS["azerbaijan"]="ğŸ‡¦ğŸ‡¿"
  FLAGS["bosnia and herzegovina"]="ğŸ‡§ğŸ‡¦"
  FLAGS["barbados"]="ğŸ‡§ğŸ‡§"
  FLAGS["bangladesh"]="ğŸ‡§ğŸ‡©"
  FLAGS["belgium"]="ğŸ‡§ğŸ‡ª"
  FLAGS["burkina faso"]="ğŸ‡§ğŸ‡«"
  FLAGS["bulgaria"]="ğŸ‡§ğŸ‡¬"
  FLAGS["bahrain"]="ğŸ‡§ğŸ‡­"
  FLAGS["burundi"]="ğŸ‡§ğŸ‡®"
  FLAGS["benin"]="ğŸ‡§ğŸ‡¯"
  FLAGS["st. barthÃ©lemy"]="ğŸ‡§ğŸ‡±"
  FLAGS["bermuda"]="ğŸ‡§ğŸ‡²"
  FLAGS["brunei"]="ğŸ‡§ğŸ‡³"
  FLAGS["bolivia"]="ğŸ‡§ğŸ‡´"
  FLAGS["caribbean netherlands"]="ğŸ‡§ğŸ‡¶"
  FLAGS["brazil"]="ğŸ‡§ğŸ‡·"
  FLAGS["bahamas"]="ğŸ‡§ğŸ‡¸"
  FLAGS["bhutan"]="ğŸ‡§ğŸ‡¹"
  FLAGS["bouvet island"]="ğŸ‡§ğŸ‡»"
  FLAGS["botswana"]="ğŸ‡§ğŸ‡¼"
  FLAGS["belarus"]="ğŸ‡§ğŸ‡¾"
  FLAGS["belize"]="ğŸ‡§ğŸ‡¿"
  FLAGS["canada"]="ğŸ‡¨ğŸ‡¦"
  FLAGS["cocos (keeling) islands"]="ğŸ‡¨ğŸ‡¨"
  FLAGS["congo - kinshasa"]="ğŸ‡¨ğŸ‡©"
  FLAGS["central african republic"]="ğŸ‡¨ğŸ‡«"
  FLAGS["congo - brazzaville"]="ğŸ‡¨ğŸ‡¬"
  FLAGS["switzerland"]="ğŸ‡¨ğŸ‡­"
  FLAGS["cÃ´te dâ€™ivoire"]="ğŸ‡¨ğŸ‡®"
  FLAGS["cook islands"]="ğŸ‡¨ğŸ‡°"
  FLAGS["chile"]="ğŸ‡¨ğŸ‡±"
  FLAGS["cameroon"]="ğŸ‡¨ğŸ‡²"
  FLAGS["china"]="ğŸ‡¨ğŸ‡³"
  FLAGS["colombia"]="ğŸ‡¨ğŸ‡´"
  FLAGS["clipperton island"]="ğŸ‡¨ğŸ‡µ"
  FLAGS["costa rica"]="ğŸ‡¨ğŸ‡·"
  FLAGS["cuba"]="ğŸ‡¨ğŸ‡º"
  FLAGS["cape verde"]="ğŸ‡¨ğŸ‡»"
  FLAGS["curaÃ§ao"]="ğŸ‡¨ğŸ‡¼"
  FLAGS["christmas island"]="ğŸ‡¨ğŸ‡½"
  FLAGS["cyprus"]="ğŸ‡¨ğŸ‡¾"
  FLAGS["czechia"]="ğŸ‡¨ğŸ‡¿"
  FLAGS["germany"]="ğŸ‡©ğŸ‡ª"
  FLAGS["diego garcia"]="ğŸ‡©ğŸ‡¬"
  FLAGS["djibouti"]="ğŸ‡©ğŸ‡¯"
  FLAGS["denmark"]="ğŸ‡©ğŸ‡°"
  FLAGS["dominica"]="ğŸ‡©ğŸ‡²"
  FLAGS["dominican republic"]="ğŸ‡©ğŸ‡´"
  FLAGS["algeria"]="ğŸ‡©ğŸ‡¿"
  FLAGS["ceuta and melilla"]="ğŸ‡ªğŸ‡¦"
  FLAGS["ecuador"]="ğŸ‡ªğŸ‡¨"
  FLAGS["estonia"]="ğŸ‡ªğŸ‡ª"
  FLAGS["egypt"]="ğŸ‡ªğŸ‡¬"
  FLAGS["western sahara"]="ğŸ‡ªğŸ‡­"
  FLAGS["eritrea"]="ğŸ‡ªğŸ‡·"
  FLAGS["spain"]="ğŸ‡ªğŸ‡¸"
  FLAGS["ethiopia"]="ğŸ‡ªğŸ‡¹"
  FLAGS["european union"]="ğŸ‡ªğŸ‡º"
  FLAGS["finland"]="ğŸ‡«ğŸ‡®"
  FLAGS["fiji"]="ğŸ‡«ğŸ‡¯"
  FLAGS["falkland islands"]="ğŸ‡«ğŸ‡°"
  FLAGS["micronesia"]="ğŸ‡«ğŸ‡²"
  FLAGS["faroe islands"]="ğŸ‡«ğŸ‡´"
  FLAGS["france"]="ğŸ‡«ğŸ‡·"
  FLAGS["gabon"]="ğŸ‡¬ğŸ‡¦"
  FLAGS["united kingdom"]="ğŸ‡¬ğŸ‡§"
  FLAGS["grenada"]="ğŸ‡¬ğŸ‡©"
  FLAGS["georgia"]="ğŸ‡¬ğŸ‡ª"
  FLAGS["french guiana"]="ğŸ‡¬ğŸ‡«"
  FLAGS["guernsey"]="ğŸ‡¬ğŸ‡¬"
  FLAGS["ghana"]="ğŸ‡¬ğŸ‡­"
  FLAGS["gibraltar"]="ğŸ‡¬ğŸ‡®"
  FLAGS["greenland"]="ğŸ‡¬ğŸ‡±"
  FLAGS["gambia"]="ğŸ‡¬ğŸ‡²"
  FLAGS["guinea"]="ğŸ‡¬ğŸ‡³"
  FLAGS["guadeloupe"]="ğŸ‡¬ğŸ‡µ"
  FLAGS["equatorial guinea"]="ğŸ‡¬ğŸ‡¶"
  FLAGS["greece"]="ğŸ‡¬ğŸ‡·"
  FLAGS["south georgia and south sandwich islands"]="ğŸ‡¬ğŸ‡¸"
  FLAGS["guatemala"]="ğŸ‡¬ğŸ‡¹"
  FLAGS["guam"]="ğŸ‡¬ğŸ‡º"
  FLAGS["guinea-bissau"]="ğŸ‡¬ğŸ‡¼"
  FLAGS["guyana"]="ğŸ‡¬ğŸ‡¾"
  FLAGS["hong kong sar china"]="ğŸ‡­ğŸ‡°"
  FLAGS["heard and mcdonald islands"]="ğŸ‡­ğŸ‡²"
  FLAGS["honduras"]="ğŸ‡­ğŸ‡³"
  FLAGS["croatia"]="ğŸ‡­ğŸ‡·"
  FLAGS["haiti"]="ğŸ‡­ğŸ‡¹"
  FLAGS["hungary"]="ğŸ‡­ğŸ‡º"
  FLAGS["canary islands"]="ğŸ‡®ğŸ‡¨"
  FLAGS["indonesia"]="ğŸ‡®ğŸ‡©"
  FLAGS["ireland"]="ğŸ‡®ğŸ‡ª"
  FLAGS["israel"]="ğŸ‡®ğŸ‡±"
  FLAGS["isle of man"]="ğŸ‡®ğŸ‡²"
  FLAGS["india"]="ğŸ‡®ğŸ‡³"
  FLAGS["british indian ocean territory"]="ğŸ‡®ğŸ‡´"
  FLAGS["iraq"]="ğŸ‡®ğŸ‡¶"
  FLAGS["iran"]="ğŸ‡®ğŸ‡·"
  FLAGS["iceland"]="ğŸ‡®ğŸ‡¸"
  FLAGS["italy"]="ğŸ‡®ğŸ‡¹"
  FLAGS["jersey"]="ğŸ‡¯ğŸ‡ª"
  FLAGS["jamaica"]="ğŸ‡¯ğŸ‡²"
  FLAGS["jordan"]="ğŸ‡¯ğŸ‡´"
  FLAGS["japan"]="ğŸ‡¯ğŸ‡µ"
  FLAGS["kenya"]="ğŸ‡°ğŸ‡ª"
  FLAGS["kyrgyzstan"]="ğŸ‡°ğŸ‡¬"
  FLAGS["cambodia"]="ğŸ‡°ğŸ‡­"
  FLAGS["kiribati"]="ğŸ‡°ğŸ‡®"
  FLAGS["comoros"]="ğŸ‡°ğŸ‡²"
  FLAGS["st. kitts and nevis"]="ğŸ‡°ğŸ‡³"
  FLAGS["north korea"]="ğŸ‡°ğŸ‡µ"
  FLAGS["south korea"]="ğŸ‡°ğŸ‡·"
  FLAGS["kuwait"]="ğŸ‡°ğŸ‡¼"
  FLAGS["cayman islands"]="ğŸ‡°ğŸ‡¾"
  FLAGS["kazakhstan"]="ğŸ‡°ğŸ‡¿"
  FLAGS["laos"]="ğŸ‡±ğŸ‡¦"
  FLAGS["lebanon"]="ğŸ‡±ğŸ‡§"
  FLAGS["st. lucia"]="ğŸ‡±ğŸ‡¨"
  FLAGS["liechtenstein"]="ğŸ‡±ğŸ‡®"
  FLAGS["sri lanka"]="ğŸ‡±ğŸ‡°"
  FLAGS["liberia"]="ğŸ‡±ğŸ‡·"
  FLAGS["lesotho"]="ğŸ‡±ğŸ‡¸"
  FLAGS["lithuania"]="ğŸ‡±ğŸ‡¹"
  FLAGS["luxembourg"]="ğŸ‡±ğŸ‡º"
  FLAGS["latvia"]="ğŸ‡±ğŸ‡»"
  FLAGS["libya"]="ğŸ‡±ğŸ‡¾"
  FLAGS["morocco"]="ğŸ‡²ğŸ‡¦"
  FLAGS["monaco"]="ğŸ‡²ğŸ‡¨"
  FLAGS["moldova"]="ğŸ‡²ğŸ‡©"
  FLAGS["montenegro"]="ğŸ‡²ğŸ‡ª"
  FLAGS["st. martin"]="ğŸ‡²ğŸ‡«"
  FLAGS["madagascar"]="ğŸ‡²ğŸ‡¬"
  FLAGS["marshall islands"]="ğŸ‡²ğŸ‡­"
  FLAGS["north macedonia"]="ğŸ‡²ğŸ‡°"
  FLAGS["mali"]="ğŸ‡²ğŸ‡±"
  FLAGS["myanmar (burma)"]="ğŸ‡²ğŸ‡²"
  FLAGS["mongolia"]="ğŸ‡²ğŸ‡³"
  FLAGS["macao sar china"]="ğŸ‡²ğŸ‡´"
  FLAGS["northern mariana islands"]="ğŸ‡²ğŸ‡µ"
  FLAGS["martinique"]="ğŸ‡²ğŸ‡¶"
  FLAGS["mauritania"]="ğŸ‡²ğŸ‡·"
  FLAGS["montserrat"]="ğŸ‡²ğŸ‡¸"
  FLAGS["malta"]="ğŸ‡²ğŸ‡¹"
  FLAGS["mauritius"]="ğŸ‡²ğŸ‡º"
  FLAGS["maldives"]="ğŸ‡²ğŸ‡»"
  FLAGS["malawi"]="ğŸ‡²ğŸ‡¼"
  FLAGS["mexico"]="ğŸ‡²ğŸ‡½"
  FLAGS["malaysia"]="ğŸ‡²ğŸ‡¾"
  FLAGS["mozambique"]="ğŸ‡²ğŸ‡¿"
  FLAGS["namibia"]="ğŸ‡³ğŸ‡¦"
  FLAGS["new caledonia"]="ğŸ‡³ğŸ‡¨"
  FLAGS["niger"]="ğŸ‡³ğŸ‡ª"
  FLAGS["norfolk island"]="ğŸ‡³ğŸ‡«"
  FLAGS["nigeria"]="ğŸ‡³ğŸ‡¬"
  FLAGS["nicaragua"]="ğŸ‡³ğŸ‡®"
  FLAGS["netherlands"]="ğŸ‡³ğŸ‡±"
  FLAGS["norway"]="ğŸ‡³ğŸ‡´"
  FLAGS["nepal"]="ğŸ‡³ğŸ‡µ"
  FLAGS["nauru"]="ğŸ‡³ğŸ‡·"
  FLAGS["niue"]="ğŸ‡³ğŸ‡º"
  FLAGS["new zealand"]="ğŸ‡³ğŸ‡¿"
  FLAGS["oman"]="ğŸ‡´ğŸ‡²"
  FLAGS["panama"]="ğŸ‡µğŸ‡¦"
  FLAGS["peru"]="ğŸ‡µğŸ‡ª"
  FLAGS["french polynesia"]="ğŸ‡µğŸ‡«"
  FLAGS["papua new guinea"]="ğŸ‡µğŸ‡¬"
  FLAGS["philippines"]="ğŸ‡µğŸ‡­"
  FLAGS["pakistan"]="ğŸ‡µğŸ‡°"
  FLAGS["poland"]="ğŸ‡µğŸ‡±"
  FLAGS["st. pierre and miquelon"]="ğŸ‡µğŸ‡²"
  FLAGS["pitcairn islands"]="ğŸ‡µğŸ‡³"
  FLAGS["puerto rico"]="ğŸ‡µğŸ‡·"
  FLAGS["palestinian territories"]="ğŸ‡µğŸ‡¸"
  FLAGS["portugal"]="ğŸ‡µğŸ‡¹"
  FLAGS["palau"]="ğŸ‡µğŸ‡¼"
  FLAGS["paraguay"]="ğŸ‡µğŸ‡¾"
  FLAGS["qatar"]="ğŸ‡¶ğŸ‡¦"
  FLAGS["rÃ©union"]="ğŸ‡·ğŸ‡ª"
  FLAGS["romania"]="ğŸ‡·ğŸ‡´"
  FLAGS["serbia"]="ğŸ‡·ğŸ‡¸"
  FLAGS["russia"]="ğŸ‡·ğŸ‡º"
  FLAGS["rwanda"]="ğŸ‡·ğŸ‡¼"
  FLAGS["saudi arabia"]="ğŸ‡¸ğŸ‡¦"
  FLAGS["solomon islands"]="ğŸ‡¸ğŸ‡§"
  FLAGS["seychelles"]="ğŸ‡¸ğŸ‡¨"
  FLAGS["sudan"]="ğŸ‡¸ğŸ‡©"
  FLAGS["sweden"]="ğŸ‡¸ğŸ‡ª"
  FLAGS["singapore"]="ğŸ‡¸ğŸ‡¬"
  FLAGS["st. helena"]="ğŸ‡¸ğŸ‡­"
  FLAGS["slovenia"]="ğŸ‡¸ğŸ‡®"
  FLAGS["svalbard and jan mayen"]="ğŸ‡¸ğŸ‡¯"
  FLAGS["slovakia"]="ğŸ‡¸ğŸ‡°"
  FLAGS["sierra leone"]="ğŸ‡¸ğŸ‡±"
  FLAGS["san marino"]="ğŸ‡¸ğŸ‡²"
  FLAGS["senegal"]="ğŸ‡¸ğŸ‡³"
  FLAGS["somalia"]="ğŸ‡¸ğŸ‡´"
  FLAGS["suriname"]="ğŸ‡¸ğŸ‡·"
  FLAGS["south sudan"]="ğŸ‡¸ğŸ‡¸"
  FLAGS["sÃ£o tomÃ© and prÃ­ncipe"]="ğŸ‡¸ğŸ‡¹"
  FLAGS["el salvador"]="ğŸ‡¸ğŸ‡»"
  FLAGS["sint maarten"]="ğŸ‡¸ğŸ‡½"
  FLAGS["syria"]="ğŸ‡¸ğŸ‡¾"
  FLAGS["eswatini"]="ğŸ‡¸ğŸ‡¿"
  FLAGS["tristan da cunha"]="ğŸ‡¹ğŸ‡¦"
  FLAGS["turks and caicos islands"]="ğŸ‡¹ğŸ‡¨"
  FLAGS["chad"]="ğŸ‡¹ğŸ‡©"
  FLAGS["french southern territories"]="ğŸ‡¹ğŸ‡«"
  FLAGS["togo"]="ğŸ‡¹ğŸ‡¬"
  FLAGS["thailand"]="ğŸ‡¹ğŸ‡­"
  FLAGS["tajikistan"]="ğŸ‡¹ğŸ‡¯"
  FLAGS["tokelau"]="ğŸ‡¹ğŸ‡°"
  FLAGS["timor-leste"]="ğŸ‡¹ğŸ‡±"
  FLAGS["turkmenistan"]="ğŸ‡¹ğŸ‡²"
  FLAGS["tunisia"]="ğŸ‡¹ğŸ‡³"
  FLAGS["tonga"]="ğŸ‡¹ğŸ‡´"
  FLAGS["turkey"]="ğŸ‡¹ğŸ‡·"
  FLAGS["trinidad and tobago"]="ğŸ‡¹ğŸ‡¹"
  FLAGS["tuvalu"]="ğŸ‡¹ğŸ‡»"
  FLAGS["taiwan"]="ğŸ‡¹ğŸ‡¼"
  FLAGS["tanzania"]="ğŸ‡¹ğŸ‡¿"
  FLAGS["ukraine"]="ğŸ‡ºğŸ‡¦"
  FLAGS["uganda"]="ğŸ‡ºğŸ‡¬"
  FLAGS["u.s. outlying islands"]="ğŸ‡ºğŸ‡²"
  FLAGS["united nations"]="ğŸ‡ºğŸ‡³"
  FLAGS["united states"]="ğŸ‡ºğŸ‡¸"
  FLAGS["uruguay"]="ğŸ‡ºğŸ‡¾"
  FLAGS["uzbekistan"]="ğŸ‡ºğŸ‡¿"
  FLAGS["vatican city"]="ğŸ‡»ğŸ‡¦"
  FLAGS["st. vincent and grenadines"]="ğŸ‡»ğŸ‡¨"
  FLAGS["venezuela"]="ğŸ‡»ğŸ‡ª"
  FLAGS["british virgin islands"]="ğŸ‡»ğŸ‡¬"
  FLAGS["u.s. virgin islands"]="ğŸ‡»ğŸ‡®"
  FLAGS["vietnam"]="ğŸ‡»ğŸ‡³"
  FLAGS["vanuatu"]="ğŸ‡»ğŸ‡º"
  FLAGS["wallis and futuna"]="ğŸ‡¼ğŸ‡«"
  FLAGS["samoa"]="ğŸ‡¼ğŸ‡¸"
  FLAGS["kosovo"]="ğŸ‡½ğŸ‡°"
  FLAGS["yemen"]="ğŸ‡¾ğŸ‡ª"
  FLAGS["mayotte"]="ğŸ‡¾ğŸ‡¹"
  FLAGS["south africa"]="ğŸ‡¿ğŸ‡¦"
  FLAGS["zambia"]="ğŸ‡¿ğŸ‡²"
  FLAGS["zimbabwe"]="ğŸ‡¿ğŸ‡¼"
  FLAGS["england"]="ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿"
  FLAGS["scotland"]="ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿"
  FLAGS["wales"]="ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿"


  print ".. _testimonials:"
  print ""
  print "Who is using SCT?"
  print "#################"
  print ""
}

# skip table header
NR == 1 { next }

{
  timestamp=$1
  name=$2
  degree=$3
  md=$4
  affiliation=$5
  city="" # not in the dataset!
  country=$6
  OS=$7
  rating=$8
  testimonial=$9
  feedback=$10


  # convert country name to emoji, if possible
  if(FLAGS[tolower(country)] != "") {
    country = FLAGS[tolower(country)]
  }

  # location = city + country, but only if both are defined
  # if both are null, so is location.
  if(city != "" && country != "") {
    location = city " " country
  } else {
    location = city country
  }

  # medical doctor degree
  if(md != "") {
    md=", MD"
  }

  # prepend section separators
  if(degree != "") {
    degree=", " degree
  }
  if(affiliation != "") {
    affiliation = " | " affiliation
  }
  if(location != "") {
    location = " | " location
  }

  print ".. admonition:: " name md degree affiliation location
  print "   :class: testimonial"
  print ""
  # .rst admonitions need a 4-space indent to know the content is a continuation.
  # fmt (below) recognizes and preserves these indents.
  print "    " testimonial
  print ""
  print ""
}' "$@"
}

HERE="$(cd "$(dirname "$0")"; pwd -P)"

# To directly write on the RST file, uncomment the line below. Otherwise, copy/paste and manually organize the output
# of the terminal.
#testimonials2rst "$@" | fmt -80 | tee "${HERE}"/../documentation/source/overview/testimonials.rst
testimonials2rst "$@" | fmt -80